# 垃圾回收与内存泄漏

1. 浏览器的垃圾回收机制
    1. 垃圾回收的概念
        - 垃圾回收：当变量不在参与运行时，系统收回被占用的内存空间，这就是垃圾回收。
        - 回收机制：
            - Javascript 具有自动垃圾回收机制，会定期对那些不再使用的变量、对象所占用的内存进行释放，原理就是找到不再使用的变量，然后释放掉其占用的内存。
            - JavaScript中存在两种变量：
                - 全局变量的生命周期会持续到页面卸载；
                - 局部变量声明在函数中，它的生命周期从函数执行开始，直到函数执行结束，
                - 局部变量被外部函数使用时，在函数执行结束后，函数外部的变量依然指向函数内部的局部变量，此时局部变量依然在被使用，所以不会回收。如，闭包

    2. 垃圾回收的方式
        1. 标记清除
            - 当变量进入执行环境时，就标记这个变量“进入环境”
            - 当变量离开环境时，就会被标记为“离开环境”
            - 先给存储在内存中的所有变量都加上标记。
            - 然后去掉被引用的标记。
            - 最后销毁那些带标记的值，并回收他们所占用的内存空间。

        2. 引用计数
            - 引用计数就是跟踪记录每个值被引用的次数。
            - 引用次数变为0时，下次回收期就释放这个变量所占有的内存空间。
            - 循环引用的变量不会被回收。

        3. 减少垃圾回收
            1. 数组优化： 用[]来清空数组。
            2. object优化： 用null来清空对象。
            3. 函数优化： 可复用的函数，尽量放在外侧。

2. 哪些情况会导致内存泄漏
     1. 意外的全局变量
     2. 被遗忘的计时器或回调函数
     3. 脱离 DOM 的引用： 获取一个 DOM 元素的引用，而后面这个元素被删除，由于一直保留了对这个元素的引用，所以它也无法被回收。
     4. 闭包： 不合理的使用闭包，从而导致某些变量一直被留在内存当中。

引用计数

- 跟踪值被使用的次数，当值的引用次数为0时，就会被垃圾回收器回收。
- 缺点：
    - 无法回收循环引用的值。
    - 无法回收被遗忘的值。（BOM 和 DOM）

标记清除

- 遍历所有的对象，找到活动对象，进行标记
- 遍历所有的对象，清除没有标记的。
- 回收空间
- 解决对象循环引用的不能回收问题
- 缺点：
    - 不能立即回收垃圾对象
    - 容易产生碎片化空间

标记整理

- 标记、清除与标记清除一样
- 清除后，移动对象位置，使得他们在地址上是一个连续的空间
- 缺点：
    - 不能立即回收垃圾对象