# 闭包

- 闭包是指有权访问另一个函数作用域中变量的函数
- 创建方式
    - 在一个函数内创建另一个函数，内部的函数可以访问到外部函数的局部变量。
- 用途
    - 在函数外部访问函数内部的变量。通过在外部调用闭包函数，从而在访问到函数内部的变量，可以使用这种方法来创建私有变量。
    - 使已经运行结束的函数上下文中的变量对象继续留在内存中，因为闭包函数保留了这个变量对象的引用，所以这个变量对象不会被回收。
- 经典面试题：使用闭包解决循环中 var 定义函数的问题
    1. 使用闭包的方式
    2. 将 i 做为 setTimeout 的第三个参数。
    3. 使用 let 定义 i

- 问题：闭包的作用和原理
    - 解题：
        - 初阶：
            - 是什么：
                - 一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）
                - 词法（lexical）一词指的是，词法作用域根据源代码中声明变量的位置来确定该变量在何处可用。
                - 词法作用域：
                    - 函数执行时会创建一个执行上下文，包含词法环境组件、变量环境组件
                    - 词法环境内部包含：环境记录器 —— 用于记录变量/函数声明；外部环境引用 —— 记录外部引用变量/函数
            - 问题：
                - 容易出现内存泄露
                - 循环 配合 var 时，容易出现意外情况（因为变量提升了，解决方案可以用 let/立即执行函数）：

                    ```js
                    function run(){
                        for(var i =0;i<9;i++{
                            setTimeout(()=>{
                            console.log(i);
                            },0)
                        }
                    }
                    ```

                - 作用：将函数与其所操作的某些数据（环境）关联起来
                - FP、私有属性
        - 中阶：
            - 如果有问到，可以展开聊聊什么是执行上下文、函数执行基本过程、作用域，这些基础概念
        - 高阶：
            - 有相关性能优化经验
            - 了解浏览器底层实现

    - 资料：
        - <https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures>
        - <https://juejin.cn/post/7043408377661095967>
