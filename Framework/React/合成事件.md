# React 合成事件

#react
#合成事件

- 解题：
    - 初阶：
        - 合成事件是什么？有什么作用？有什么副作用？
        - 合成事件 vs 原生事件有什么区别？
    - 中阶：
        - 展开讲解事件注册 & 分发的过程，聊实现原理
            - 分发过程：通过原生事件的 target 属性找到对应 fiber 实例，
    - 高阶：重要版本更新：
        - V16 之前有事件池设计，原意提升性能，但用法上比较让人confuse，所以 V17 放弃了；
        - V17 之后，事件绑定到 root 元素，而不是 document
        - V18 在事件处理系统有一丢丢优化，差异不大；

- 知识点：
    - 原理：本质上是基于冒泡，自行实现的另一套 DOM Event 逻辑，有点影子的意思
    - 作用：
        - 抹平 IE 与其它浏览器的兼容性问题
        - 将事件统一绑定到 root元素(v17 之前是document 对象)，再利用 DOM event 的事件冒泡触发合成事件 —— 其实是一种比较复杂的事件委托实现
    - 事件池与，为什么放弃事件池设计？
    - 原生事件与合成事件系统并存

- why
    - 减少浏览器兼容性问题
    - 减少内存占用
- 原生事件和合成事件的区别
    - 原生事件
        - 事件绑定在真实 DOM 上
        - 在目标阶段触发，
    - 合成事件
        - 事件绑定在 root 元素上
        - 在冒泡阶段触发
        - 相当于事件委托
    - 原生事件阻止冒泡，会阻止合成事件，合成事件阻止冒泡，不会阻止原生事件
- 合成事件：挂载时，通过listenerBank把事件存起来，触发时，document进行dispatchEvent，找到触发事件的最深的一个节点，向上遍历拿到所有的callback放在eventQueue，根据事件类型构建event对象，遍历执行eventQueue
    - 事件注册
        - 从虚拟 Dom 树的 props 中找到事件属性，得到事件类型和事件处理函数
        - 在 root 元素上注册事件处理函数，事件处理函数会调用 dispatchEvent 方法
    - 事件存储
        - 将事件处理函数和事件类型存储到 listenerBank 中
    - 事件合成
        - 根据事件类型，构建合成事件对象
    - 事件分发
        - 遍历找到当前元素及父元素所有绑定的事件处理函数，放入事件队列
    - 事件执行
        - 从事件队列中取出事件处理函数，执行
